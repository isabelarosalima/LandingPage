<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="CSS/cadastro.css">
</head>
<body>
  <a href="cadastro.html"><img src="assets/icons/seta-para-a-esquerda.png" alt="" ></a>
 <!--a div ring começa aqui-->
  <div class="ring">
    <i style="--clr:#ff0051;"></i>
    <i style="--clr:#0078d4;"></i>
    <i style="--clr:#e69602;"></i>
   <!--a div do login começa aqui -->
    <div class="login">
      <h2>BEM-VINDO DE VOLTA! </h2>
        <span>APROVEITE NOSSO SITE APROVEITE NOSSO SITE APROVEITE NOSSO SITE APROVEITE NOSSO SITE APROVEITE NOSSO SITE APROVEITE NOSSO SITE APROVEITE NOSSO SITE APROVEITE NOSSO SITE  </span>
      <div class="inputBx">
        <input type="text" placeholder="E-mail" id="input_emailLogin">
      </div>

      <div id="mensagemErroEmailLogin">Mensagem</div>
      
      <div class="inputBx">
        <input type="password" placeholder="Senha" id="input_senhaLogin">
      </div>
  
      <div id="mensagemErroSenhaLogin">Mensagem</div>

      <div class="inputBx">
       <input type="submit" value="LOGAR" onclick="entrar()">
      </div>
  
      <div class="links">
        <p>Não possui conta? <a href="index.html">Cadastrar</a> </p> 
      </div>
    </div>
  </div>
</body>
</html>
<script>
const email = document.getElementById('input_emailLogin');
const senha = document.getElementById('input_senhaLogin');

let validEmail = false;
let validSenha = false;


email.addEventListener('keyup', () => {
    if(email.value.indexOf('@') == -1 || !email.value.endsWith(`.com`) || email.value.trim().length < 10){
      mensagemErroEmailLogin.setAttribute('style', 'color: #706f6f')
      mensagemErroEmailLogin.innerHTML = ' É preciso ter no mínimo 10 caracteres, @ e .com'
      validEmail = false
    }else{
      mensagemErroEmailLogin.setAttribute('style', 'color: transparent')
      mensagemErroEmailLogin.innerHTML = `correto`
      validEmail = true
    }
})


senha.addEventListener('keyup', () => {
    const senhaValor = senha.value;
    // estou utilizando REGEX (expressões regulares) são padrões usados para corresponder a combinações de caracteres em strings
    const senhaValida = senhaValor.length >= 8 && /[!@#$%^&*(),.?":{}|<>]/.test(senhaValor) && 
    /[0-9]/.test(senhaValor);   
    //O método test é usado para testar se a expressão regular encontra uma correspondência na string (variável senhaValida)              

      // Verifica se a senha tem pelo menos 8 caracteres
      // Verifica se a senha contém pelo menos um caractere especial
      // Verifica se a senha contém pelo menos um número

    if (!senhaValida) {
        mensagemErroSenhaLogin.setAttribute('style', 'color: #706f6f');
        mensagemErroSenhaLogin.innerHTML = 'É preciso ter no mínimo 8 caracteres, 1 caractere especial e 1 número';
        validSenha = false;
    } else {
        mensagemErroSenhaLogin.setAttribute('style', 'color: transparent');
        mensagemErroSenhaLogin.innerHTML = 'Correto';
        validSenha = true;
    }
});

function entrar() {
        // aguardar();

        var emailVar = input_emailLogin.value;
        var senhaVar = input_senhaLogin.value;

        if (emailVar == "" || senhaVar == "") {
            cardErro.style.display = "block"
           alert(`Mensagem de erro para todos os campos em branco`) ;
            // finalizarAguardar();
            return false;
        }

        console.log("FORM LOGIN: ", emailVar);
        console.log("FORM SENHA: ", senhaVar);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: emailVar,
                senhaServer: senhaVar
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;
                    sessionStorage.AQUARIOS = JSON.stringify(json.aquarios)

                    alert(`Redirecionando para tela de usuario...`)

                    setTimeout(function () {
                        window.location = "inicioQuiz.html";
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    // finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
            alert(`Redirecionando para tela de usuario...`)
        })

        return false;
    }

    // function sumirMensagem() {
    //     cardErro.style.display = "none"
    // }
    
</script>